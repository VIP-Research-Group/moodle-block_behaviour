/*! moodle-block_behaviour v0.9.2 26-07-2022 */

!function(e){"function"==typeof define&&define.amd?define([],e):window.behaviourAnalytics=e()}(function(){return function(u){var a,l,m,c,i,s,v,h,d,y,r,b,p,g,f,x,k,E,I,L,w,T,B,M,C,H,A,N,S,O,_,j,F,R,q,D,z,U,W,X,G,P,Y,J,Z,K,Q,V,$,ee,t,te,ne,re,e,oe,le,o,ie,se,ae,ce,de,ue,me,ye,pe,ge,fe,ve,he,be,xe,ke,Ee,Ie,Le,we,Te,Be,Me,Ce,He,Ae,Ne,Se,Oe,_e,je,Fe,Re,qe,De,ze,Ue,We,Xe,Ge,Pe,Ye,Je,Ze,Ke,Qe,Ve,$e,et,tt,nt,rt,ot,lt,it,st,at,ct,dt={},ut=[];function mt(){b.forEach(function(e){for(;!ke[e.entype];){var t,n=be[Math.floor(G.random()*be.length)],r=!0;for(t in ke)ke[t]==n&&(r=!1);ke[e.entype]=r?n:void 0}})}function yt(){ne={nodes:[],links:[],edges:{},maxSession:0},n(),pt()}function n(){var t,n,r,o=ne,l={};b.forEach(function(e){t=!0,r=n=void 0,E[e.id]?(t=E[e.id].visible&&E["g"+e.sect].visible?1:0,E[e.id].visible&&!t&&(E[e.id].visible=0),n=E[e.id].xcoord,r=E[e.id].ycoord):E["g"+e.sect]&&(t=!(!E["g"+e.sect].visible||T!=O)),o.nodes[o.nodes.length]={id:e.id,name:e.name,group:e.sect,type:e.type,entype:e.entype,colour:ke[e.entype],visible:t,xcoord:n,ycoord:r},l[e.sect]||(E["g"+e.sect]&&(t=E["g"+e.sect].visible?1:0,n=E["g"+e.sect].xcoord,r=E["g"+e.sect].ycoord),l[e.sect]={id:"g"+e.sect,name:q.section+" "+e.sect,group:e.sect,type:"grouping",colour:ke.grouping,visible:t,xcoord:n,ycoord:r},o.nodes[o.nodes.length]=l[e.sect]),o.links[o.links.length]={source:"g"+e.sect,target:e.id,weight:$,colour:ke.originalLinks}}),n=r=void 0,E.root&&(n=E.root.xcoord,r=E.root.ycoord);var e,i,s,a,c={id:"root",name:g,group:-1,type:"grouping",colour:ke.grouping,visible:1,xcoord:n,ycoord:r};for(e in l)o.links[o.links.length]={source:"root",target:l[e].id,weight:$,colour:ke.originalLinks};if(o.nodes[o.nodes.length]=c,0<Object.keys(I).length){for(a in I)i=(s=a.split("_"))[0],s=s[1],o.links[o.links.length]={source:i,target:s,weight:5*I[a],colour:ke.originalLinks};if(!k)for(var d in o.nodes)isNaN(o.nodes[d].id)&&(o.nodes[d].visible=0)}}function pt(){var e,t=ne,n=0,r=0;nt={};for(var o=0;o<v.length;o++)e={source:v[o].moduleId,target:v[o].moduleId,weight:$,user:v[o].userId,colour:""},t.edges[v[o].userId]||(t.edges[v[o].userId]=[],nt[v[o].userId]=[],t.maxSession=t.maxSession<n?n:t.maxSession,r=n=0),E[v[o].moduleId]&&E[v[o].moduleId].visible&&(nt[v[o].userId][r++]=v[o].moduleId),o+1<v.length&&v[o].userId==v[o+1].userId?(e.target=v[o+1].moduleId,t.edges[v[o].userId][n++]=e):0==t.edges[v[o].userId].length&&(t.edges[v[o].userId][n++]=e);t.maxSession=t.maxSession<n?n:t.maxSession,h.forEach(function(e){t.edges[e.id]||(t.edges[e.id]=[])})}function gt(){Ie=!1,t=ee=.01,Xe=Rt,Ge=qt,Pe=Dt,Qe&&0<Object.keys(E).length&&($=0),B&&C&&function(){var e=document.getElementById("student-menu"),t=document.createElement("div"),n=document.createElement("button");n.innerHTML=q.copy,n.className="btn btn-secondary mb-1",n.addEventListener("click",Mt),t.appendChild(n);var r=n.getBoundingClientRect().height,n=document.createElement("button");n.innerHTML=q.print,n.className="btn btn-secondary mb-1",n.addEventListener("click",Ct),t.appendChild(n),e.appendChild(t),(he=document.createElement("select")).size=3,he.id="teacher-select",he.style.minWidth="40px";var o,r=J-r-80;for(o in he.style.height=r+"px",he.addEventListener("change",Ht),C){var l=document.createElement("option");l.value=o,l.text=o,T==o&&(l.selected=!0),he.appendChild(l)}e.appendChild(he)}(),ft(0),Nt(),function(){var e=document.getElementById("student-menu"),t=document.createElement("input");t.id="weight-slider",t.type="range",t.min="-0.2",t.max="1",t.step="0.2",t.value="0",t.style.width="130px",t.addEventListener("change",function(){V.strength(this.value),document.getElementById("weights-output").innerHTML="&nbsp;= "+this.value}),e.appendChild(t);var n=document.createTextNode(q.linksweight);e.appendChild(n),(n=document.createElement("label")).id="weights-output",n.innerHTML="&nbsp;= "+t.value,e.appendChild(n)}(),setTimeout(function(){Z.force("charge",null).force("x",null).force("y",null)},500)}function ft(e){P=U.select("#graph").append("svg").attr("width",Y).attr("height",J),V=U.forceLink(ne.links).id(function(e){return e.id}).strength(e),Z=U.forceSimulation(ne.nodes).force("link",V).force("charge",U.forceManyBody().strength(-80)).force("collide",U.forceCollide().radius(12)).force("center",U.forceCenter(Y/2,J/2)).force("x",U.forceX()).force("y",U.forceY()),vt(ne.nodes,Ye,Xe,Ge,Pe),ht(ne.links),P.on("click",function(){U.selectAll("#rctext").remove(),U.selectAll("#rcrect").remove(),(Ie||x)&&K.on("mouseover",bt).on("mouseout",kt),ie&&K.on("mouseover",null).on("mouseout",null)}),Qe&&x&&0<Object.keys(E).length?Z.on("tick",It):Z.on("tick",Lt);for(var t=0;t<80;t++)Z.tick();x&&setTimeout(function(){Z.stop(),Z.on("tick",Lt),wt(),0!=Object.keys(E).length&&Qe||(Tt(null),ne.edges={},pt(),Qe=!0,$=Ie?1:0)},500),Ie&&!Qe&&setTimeout(function(){ne.nodes=[],ne.links=[],n()},600)}function vt(e,t,n,r,o){K=P.selectAll(".node").data(e).enter().append("circle").attr("class","node").attr("r",Je).style("display",function(e){return e.visible?"block":"none"}).on("mouseover",bt).on("mouseout",kt).on("contextmenu",t).call(U.drag().on("start",n).on("drag",r).on("end",o))}function ht(e){Q=P.selectAll(".link").data(e).enter().append("line").attr("class","link").style("stroke",function(e){return e.colour}).style("stroke-width",function(e){return e.weight?2*e.weight+"px":e.value/3+"px"})}function bt(e,t){var n,r,o,l,i,s,a,c,d;je||(K.on("mouseover",null),!1===t&&(U.selectAll(".text").remove(),U.selectAll("rect").remove()),Date.now()-We<150||(o=r=n=!(d=[0]),l=150,i=304,s=154,a=e.type+": "+e.name,Fe&&(s=i=0),c=P.append("text").attr("class","text").attr("id","t-"+e.id).attr("y",e.y+32).attr("dy",".40em").style("pointer-events","none").text(a).call(xt,l,e.x-78+8,d),(t=16*d[0]+16)+e.y>=J-s&&(c.attr("y",J-t-(J-e.y)).text(a).call(xt,l,e.x-78+8,d),n=!0),e.x<=i/2?(c.text(a).call(xt,l,e.x+8,d),o=!0):e.x>=Y-i/2&&(c.text(a).call(xt,l,e.x-156+8,d),r=!0),d=o?e.x:r?e.x-156:e.x-78,d=P.append("rect").attr("id","r-"+e.id).attr("x",d).attr("y",n?J-t-16-(J-e.y):e.y+16).attr("width",166).attr("height",t).style("stroke","black").style("fill","yellow"),c.raise(),isNaN(e.id)||(Fe&&(i=400,s=300),function(e,t,n,r,o,l,i,s,a,c){var d=document.createElement("iframe");d.id="preview",d.style.position="absolute",d.style.width=r+"px",d.style.height=o+"px";var u=document.getElementsByTagName("svg")[0].getBoundingClientRect(),m=document.body.getBoundingClientRect();0<m.x&&(m.x=0);d.style.left=Re?window.innerWidth-10-r+"px":Fe?"10px":i?a+u.x+"px":s?a+u.x+n-r+18+"px":a+u.x-r/2+n/2+"px";n=De?0:50;d.style.top=Fe?u.y-m.y+J/2+"px":l?n+c+u.y-m.y-o+"px":n+c+u.y+t-m.y+"px";"lti"!=e.entype&&"unknown"!=e.type&&((m=document.createElement("div")).id="bgrnd",m.style.position="absolute",m.style.width=parseInt(d.style.width)+24+"px",m.style.height=parseInt(d.style.height)+24+"px",m.style.left=parseInt(d.style.left)-12+"px",m.style.top=parseInt(d.style.top)-12+"px",m.addEventListener("mouseout",function(e){var t=this.getBoundingClientRect();e.x>t.x&&e.x<t.x+t.width&&e.y>t.y&&e.y<t.y+t.height||(qe=!1,setTimeout(Et,400))}),m.addEventListener("mouseover",function(){qe=!0}),d.src=f+"mod/"+e.entype+"/view.php?id="+e.id,document.body.appendChild(m),document.body.appendChild(d))}(e,t,l,i,s,n,o,r,parseInt(d.attr("x")),parseInt(d.attr("y"))))))}function xt(e,s,a,t){var c=0;e.each(function(){for(var e=U.select(this),t=e.text().split(/\s+/).reverse(),n=[],r=e.attr("y"),o=parseFloat(e.attr("dy")),l=e.text(null).append("tspan").attr("x",a).attr("y",r).attr("dy",o+"em"),i=t.pop();i;)n.push(i),l.text(n.join(" ")),l.node().getComputedTextLength()>s&&(n.pop(),l.text(n.join(" ")),n=[i],l=e.append("tspan").attr("x",a).attr("y",r).attr("dy",1.1*++c+o+"em").text(i)),i=t.pop()}),t[0]=++c}function kt(e){je||"lightgrey"==e.colour||(K.on("mouseout",null),Q.on("mouseout",null),setTimeout(Et,400))}function Et(){if(!qe&&(U.selectAll(".text").remove(),U.selectAll("rect").remove(),U.selectAll("#preview").remove(),U.selectAll("#bgrnd").remove(),K.on("mouseover",bt).on("mouseout",kt),Fe)){Q.on("mouseover",Hn).on("mouseout",kt);for(var e=0;e<Se.length;e++)U.select("#cluster1-"+e).on("mouseover",Mn.bind(this,e,!1)),U.select("#cluster2-"+e).on("mouseover",Mn.bind(this,e,!1))}}function It(){var t=Y/2,r=J/2,o=L;void 0===Ze.originalx?(Ze.originalx=t,Ze.originaly=r):(t=Ze.originalx,r=Ze.originaly);for(var e,n,l=0;l<ne.nodes.length;l++)e=ne.nodes[l].xcoord*o+t,n=ne.nodes[l].ycoord*o+r,(e<0||Y<e||n<0||J<n)&&(o*=.9,--l);L=o,Ze.distance=o,Q.attr("x1",function(n){var e=ne.nodes.filter(function(e){var t="string"==typeof n.source?n.source:n.source.id;return e.id==t})[0];return U.select(this).attr("y1",e.ycoord*o+r),e.xcoord*o+t}).attr("x2",function(n){var e=ne.nodes.filter(function(e){var t="string"==typeof n.target?n.target:n.target.id;return e.id==t})[0];return U.select(this).attr("y2",e.ycoord*o+r),e.xcoord*o+t}).style("display",function(e){return e.source.visible&&e.target.visible?"block":"none"}),K.attr("cx",function(e){return e.x=e.xcoord*o+t,e.x}).attr("cy",function(e){return e.y=e.ycoord*o+r,e.y}).style("display",function(e){return e.visible?"block":"none"}).style("fill",function(e){return e.colour}).raise()}function Lt(){var t=Je;Q.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).style("stroke-width",function(e){return e.weight?2*e.weight+"px":e.value/3+"px"}).style("display",function(e){return e.source.visible&&e.target.visible?"block":"none"}),K.attr("cx",function(e){return e.x=Math.max(t,Math.min(Y-t,e.x)),e.x}).attr("cy",function(e){return e.y=Math.max(t,Math.min(J-t,e.y)),e.y}).style("fill",function(e){return e.colour}).style("display",function(e){return e.visible?"block":"none"}).raise(),U.selectAll("rect").raise(),U.selectAll("text").raise()}function wt(){var e,t;A&&(U.select("#time").remove(),0==_&&(_=Date.now()),(e=new Date).setTime(_),(t=e.getMinutes())<10&&(t="0"+t),P.append("text").attr("id","time").attr("y",J-16).attr("dy",".40em").attr("x",6).style("pointer-events","none").text(A[O]+" "+e.getHours()+":"+t+" "+e.toDateString()))}function Tt(e){var t,n,r,o,l,i,s=(r={},o=0,l=Y/2,i=J/2,ne.nodes.forEach(function(e){t=e.x-l,n=e.y-i,n=Math.sqrt(t*t+n*n),o<n&&(o=n)}),L=o,ne.nodes.forEach(function(e){r[e.id]={xcoord:""+(e.x-l)/o,ycoord:""+(e.y-i)/o,visible:e.visible},e.xcoord||(e.xcoord=(e.x-l)/o,e.ycoord=(e.y-i)/o)}),{nodes:E=r,scale:o});e&&(s.links=e),B&&C&&(C[T]=s.scale,B[T]=s.nodes),s.time=Date.now(),_=s.time,H&&(H[T]=s.time),Bt(a,s)}function Bt(e,t){var n=new XMLHttpRequest;n.open("POST",e),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==this.readyState&&this.status};t=JSON.stringify(t);e==m&&(t=t.replaceAll("&","%amp;")),n.send("cid="+w+"&data="+t+"&sesskey="+D)}function Mt(){var e=new Image,t=(new XMLSerializer).serializeToString(P.node());e.src="data:image/svg+xml;base64,"+window.btoa(t),document.body.appendChild(e);t=document.createRange();t.setStartBefore(e),t.setEndAfter(e),t.selectNode(e),window.getSelection().addRange(t),document.execCommand("Copy"),document.body.removeChild(e)}function Ct(){var e=(new XMLSerializer).serializeToString(P.node()),t=window.open();t.document.write('<img src="data:image/svg+xml;base64,'+window.btoa(e)+'"/>'),t.print(),t.close()}function Ht(){for(var e,t=document.getElementById("teacher-select"),n=0;n<t.options.length;n++)if(t.options[n].selected){e=t.options[n].value;break}if(Ye=e==T?(Xe=Rt,Ge=qt,Pe=Dt,Ft):Pe=Ge=Xe=null,E=B[e],I=M[e],L=C[e],_=H[e],b=N[e],g=S[e],O=e,P.remove(),ve={},mt(),U.selectAll("#legendUL").remove(),Nt(),(lt=0)<I.length&&I[0].value){for(var r,o=[],l=Object.keys(E),i=0;i<l.length;i++)o[i]=E[l[i]],o[i].colour=ke[o[i].entype];for(r in I)I[r].colour=ke.originalLinks;ne={nodes:o,links:I,edges:{},maxSession:0},lt=1}else $=1,yt(),$=0;var s,a=document.getElementById("weights-output").innerHTML;for(s in ft(a=parseFloat(a.split(" ")[1])),ve)E[s]&&(ve[s].checked=!!E[s].visible),T==e?(ve[s].removeEventListener("change",At),ve[s].addEventListener("change",_t)):(ve[s].removeEventListener("change",_t),ve[s].addEventListener("change",At))}function At(){this.checked=!this.checked}function Nt(){var n;(fe=document.getElementById("legend")).style.width=p+"px",fe.style.height=J+"px",fe.style.minWidth=p+"px",fe.style.maxWidth="500px",fe.style.marginTop=u.version40?"200px":"50px";function t(e){var t=n-e.x;n=e.x,500<(t=parseInt(fe.style.width)+t)?t=500:t<p&&(t=p),fe.style.width=t+"px"}fe.addEventListener("mousemove",function(e){var t=fe.offsetLeft;u.version36||(t+=28),e.x>=t&&e.x<=t+6?fe.style.cursor="col-resize":fe.style.cursor="auto"}),fe.addEventListener("mousedown",function(e){n=e.x,"col-resize"==fe.style.cursor&&fe.addEventListener("mousemove",t)}),document.addEventListener("mouseup",function(){fe.removeEventListener("mousemove",t)}),function(e){var t=document.createElement("ul");t.id="legendUL";var n=document.createElement("span");n.className="no-select-text",n.innerHTML=g;var r=document.createElement("li");r.appendChild(n);var o=document.createElement("ul");r.appendChild(o),t.appendChild(r);var l,i,s,a=-1;b.sort(function(e,t){return e.sect-t.sect}),b.forEach(function(e){a!=e.sect&&((i=document.createElement("ul")).className="nested",(s=document.createElement("span")).className="caret",s.addEventListener("click",St),(l=document.createElement("li")).appendChild(s),Ot("g"+e.sect,q.section+" "+e.sect,ke.grouping,e.sect,"grouping",l),l.appendChild(i),o.appendChild(l),a=e.sect),(l=document.createElement("li")).className="indented",Ot(e.id,e.name,ke[e.entype],e.sect,e.type,l),i.appendChild(l)}),e.appendChild(t)}(fe)}function St(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}function Ot(e,t,n,r,o,l){var i=document.createElement("input");i.type="checkbox",E[e]?i.checked=!!E[e].visible:E["g"+r]?i.checked=!(!E["g"+r].visible||T!=O):i.checked=!0,i.id=e,i.group=r,i.nodeT=o,i.addEventListener("change",_t),ve[i.id]=i;r=document.createElement("label");r.style.color=n,r.className="no-select-text",r.appendChild(document.createTextNode("grouping"==o?t:o+"_"+t)),l.appendChild(i),l.appendChild(r)}function _t(){var t=this.id,n=this.checked,r=this.nodeT,o=this.group;ne.nodes.forEach(function(e){(e.id==t||"grouping"==r&&e.group==o||n&&"grouping"==e.type&&e.group==o)&&(e.visible=n?1:0,ve[e.id].checked=n)}),jt(),Pt()}function jt(){parseFloat(document.getElementById("weight-slider").value)<0&&(V.strength(0),document.getElementById("weights-output").innerHTML="&nbsp;= 0",document.getElementById("weight-slider").value=0)}function Ft(e){var t,n,r;U.selectAll(".text").remove(),U.selectAll("rect").remove(),U.selectAll("#preview").remove(),U.selectAll("#bgrnd").remove(),U.event.preventDefault(),"root"!=e.id&&(t=e,K.on("mouseover",null).on("mouseout",null),n=P.append("rect"),r=P.append("text").attr("class","text").attr("id","rctext").attr("x",e.x+10).attr("y",e.y+12).attr("dy",".40em").style("pointer-events","none").text(q.hide),e.y+20>=J&&r.attr("y",J-(J-e.y)-10).text(q.hide),n.attr("id","rcrect").attr("x",e.x).attr("y",e.y+20<=J?e.y:J-(J-e.y)-20).attr("width",60).attr("height",24).style("stroke","black").style("fill","lightgrey"),n.on("mouseover",function(){U.event.target.style="fill: grey;"}),n.on("mouseout",function(){U.event.target.style="fill: lightgrey;"}),n.on("click",function(){U.selectAll("#rctext").remove(),U.selectAll("#rcrect").remove(),K.on("mouseover",bt).on("mouseout",kt),t.visible=0,ve[t.id].checked=!1,"grouping"==t.type&&ne.nodes.forEach(function(e){e.group==t.group&&(e.visible=0,ve[e.id].checked=!1)}),jt(),Pt()}))}function Rt(e){U.event.active||Z.alphaTarget(t).restart(),e.fx=e.x,e.fy=e.y}function qt(e){U.selectAll("rect").remove(),U.selectAll(".text").remove(),U.selectAll("#preview").remove(),U.selectAll("#bgrnd").remove(),e.fx=U.event.x,e.fy=U.event.y}function Dt(e){U.event.active||(x?(Z.stop(),ne.links[0].value?Tt(ne.links):Tt(null),wt()):Z.alphaTarget(te)),e.fx=null,e.fy=null,We=Date.now()}function zt(){var e=document.getElementById("student-menu");return(o=document.createElement("button")).innerHTML=q.cluster,o.className="btn btn-secondary mb-1",o.addEventListener("click",nn),e.appendChild(o),o.getBoundingClientRect().height}function Ut(e){var t=document.getElementById("student-menu");(re=document.createElement("select")).multiple=!0,re.id="student-select";e=0<d.length?J-e-120:J-e-12;re.style="height: "+e+"px;",re.addEventListener("change",function(){for(var e=document.getElementById("student-select"),t=0;t<e.options.length;t++){var n="box-shadow: 0 0 10px 100px "+e.options[t].colour+" inset;";e.options[t].style=e.options[t].selected?n:"box-shadow: 0 0 0 0 white inset;"}0<v.length&&Yt(!0)}),1==ze?h.sort(function(e,t){e=e.firstname+" "+e.lastname,t=t.firstname+" "+t.lastname;return t<e?1:e<t?-1:0}):h.sort(function(e,t){return e.id-t.id}),h.forEach(function(e){Wt(e,re)}),t.appendChild(re)}function Wt(e,t){var n=document.createElement("option");n.value=e.id,n.text=1==ze?e.firstname+" "+e.lastname:e.id,n.colour=be[xe++],xe>=be.length&&(xe=0),ne.edges[e.id].forEach(function(e){e.colour=n.colour}),t.appendChild(n)}function Xt(){if(0!=d.length){var e,t,n=document.getElementById("student-menu");for(t in(r=document.createElement("select")).multiple=!0,r.id="group-select",r.style="height: 120px;",r.addEventListener("change",function(){U.selectAll(".link").remove(),U.selectAll(".hull").remove(),ht(ne.links),Z.on("tick",It),Z.restart(),setTimeout(Z.stop,100),re.options.length=0;for(var e=xe=0;e<r.options.length;e++)if(r.options[e].selected)for(var t=0;t<h.length;t++)y[h[t].realId]==r.options[e].value&&Wt(h[t],re)}),d)(e=document.createElement("option")).value=t,e.text=d[t],r.appendChild(e);n.appendChild(r)}}function Gt(){var t;e=document.getElementById("slider"),oe=[0,ne.maxSession],t=ne.maxSession<500?10:ne.maxSession<1e3?20:ne.maxSession<5e3?100:ne.maxSession<1e4?200:500,X.create(e,{start:[0,ne.maxSession],range:{min:[0],max:[ne.maxSession]},step:1,connect:!0,pips:{mode:"steps",stepped:!0,density:100,filter:function(e){return 0==e||e==ne.maxSession?1:e%t==0?2:0}}}),setTimeout(function(){e.noUiSlider.on("update",function(e,t){oe[t]=parseInt(e[t]),re.dispatchEvent(new Event("change"))})},1e3)}function Pt(){Q.remove(),K.remove(),U.selectAll(".hull").remove();var e=Jt(Ft);Zt(e),Qt(e),Z.alphaTarget(ee).restart(),x&&setTimeout(function(){Z.stop(),Tt(lt?ne.links:null),wt()},100)}function Yt(e){Q.remove(),K.remove(),U.selectAll(".hull").remove(),x=!1,lt&&(Ie=!0);var t=Jt(null);Zt(t),e&&Qt(t),x=!0,lt&&ne.links[0].label?(Ie=!1,Z.on("tick",Lt)):Z.on("tick",It),Z.restart(),setTimeout(Z.stop,100)}function Jt(e){var t=[],n={};return ne.nodes.forEach(function(e){null===e.fx&&(e.fx=e.x,e.fy=e.y),e.visible?t[t.length]=e:n[e.id]=1}),lt||Z.nodes(t),vt(t,e,Xe,Ge,Pe),n}function Zt(e){var t,n,r,o,l=[];for(s in ne.links)r=ne.links[s],lt&&(r.colour=ke.originalLinks),"string"==typeof r.source?(t=r.source,n=r.target,lt&&(r.source=Kt(t),r.target=Kt(n))):(t=r.source.id,n=r.target.id),e[t]||e[n]||(l[l.length]=r);for(var i=x?[]:document.getElementById("student-select").options,s=0;s<i.length;s++)if(i[s].selected){for(var a,c={},d=oe[0];d<=oe[1]&&ne.edges[i[s].value].length>d;d++)"string"==typeof(o=ne.edges[i[s].value][d]).source?(a=o.source+"_"+o.target,t=o.source,n=o.target,lt&&(o.source=Kt(t),o.target=Kt(n))):(a=o.source.id+"_"+o.target.id,t=o.source.id,n=o.target.id),c[a]?c[a]++:c[a]=1,e[t]||e[n]||(l[l.length]=o);for(d=oe[0];d<=oe[1]&&ne.edges[i[s].value].length>d;d++)a="string"==typeof(o=ne.edges[i[s].value][d]).source?o.source+"_"+o.target:o.source.id+"_"+o.target.id,o.weight=c[a]}lt||Z.force("link").links(l),ht(l)}function Kt(t){return ne.nodes.find(function(e){return e.id==t})}function Qt(e){if(!x){U.selectAll(".hull").remove();for(var t,n=document.getElementById("student-select").options,r={},o=0;o<n.length;o++)if(n[o].selected){r[n[o].value]={};for(var l=oe[0];l<=oe[1]&&ne.edges[n[o].value].length>l;l++){var i,s,a,c,d,u,m=ne.edges[n[o].value][l];u="string"==typeof m.source?(i=m.source,s=m.target,a=(u=Kt(i)).x,c=u.y,d=(u=Kt(s)).x,u.y):(i=m.source.id,s=m.target.id,a=m.source.x,c=m.source.y,d=m.target.x,m.target.y),e[i]||e[s]||(m=m.colour,r[n[o].value][i]={x:a,y:c,colour:m},r[n[o].value][s]={x:d,y:u,colour:m})}}for(t in r)en(r[t],t,!1,!1);Ie&&(rt?$t:Vt)(n)}}function Vt(e){if(Ae={},0!=Object.keys(nt).length)for(var t,n,r,o=0;o<e.length;o++)e[o].selected&&(t=e[o].value,nt[t].length<=oe[0]||(n=oe[0],r=nt[t].length>oe[1]+1?oe[1]:nt[t].length,n=parseInt(n/2+r/2),r=nt[t][n],n=parseFloat(E[r].xcoord),r=parseFloat(E[r].ycoord),Ae[t]={x:n*L+Ze.originalx,y:r*L+Ze.originaly,colour:e[o].colour}))}function $t(e){if(Ae={},0!=Object.keys(nt).length)for(var t=0;t<e.length;t++)if(e[t].selected){var n=e[t].value;if(!(nt[n].length<=oe[0])){for(var r,o=oe[0],l=nt[n].length>oe[1]+1?oe[1]:nt[n].length,i=0,s=0,a=0,c=o;c<l;c++)r=nt[n][c],i+=parseFloat(E[r].xcoord),s+=parseFloat(E[r].ycoord),a++;Ae[n]={x:i/a*L+Ze.originalx,y:s/a*L+Ze.originaly,colour:e[t].colour}}}}function en(e,t,n,r){if(0!=Object.keys(e).length){var o,l,i=[],s=20,a=Ie?"hull":n?"manual-hull":"cluster-hull";for(l in e)i[i.length]=[e[l].x,e[l].y],o=e[l].colour;if(1==i.length)p=function(e){var t=[e[0][0],e[0][1]-s],e=[e[0][0],e[0][1]+s];return"M "+t+" A "+[s,s,"0,0,0",e].join(",")+" A "+[s,s,"0,0,0",t].join(",")};else{if(2!=i.length){n=U.concaveHull().padding(15);Be||n.distance(Me);n=4<i.length?n(i):[i];return p=U.line().curve(Ce),void P.selectAll("#hull-"+t).data(n).enter().append("path").attr("id","hull-"+t).attr("class",a).style("stroke",o).style("stroke-opacity",r?0:1).style("fill",o).style("fill-opacity",r?0:He).attr("d",p)}function c(e,t){return[e[0]+t[0],e[1]+t[1]]}function d(e,t){return m(y(e),t)}var u=function(e,t){return[t[0]-e[0],t[1]-e[1]]},m=function(e,t){return[t*e[0],t*e[1]]},y=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return m(e,1/t)},p=function(e){var t=u(e[0],e[1]),n=d(t,s),r=c(e[0],m(n,-1)),o=c(e[1],n),e=1.2*s,n=d(function(e,t){e=[-(e=void 0!==t?u(e,t):e)[1],e[0]];return y(e)}(t),e),t=m(n,-1),e=c(r,t),t=c(o,t),n=c(r,n);return"M "+r+" C "+[e,t,o].join(",")+" S "+[n,r].join(",")+" Z"}}P.append("path").attr("id","hull-"+t).attr("class",a).style("stroke",o).style("stroke-opacity",r?0:1).style("fill",o).style("fill-opacity",r?0:He).attr("d",p(i))}}function tn(){clearInterval(Te),Te=void 0,Ne=null,fn(),U.selectAll(".clustering-centroid").remove(),U.selectAll(".cluster-hull").remove(),U.selectAll(".centroid").remove(),U.selectAll(".server-centroid").remove(),me.style.display="none",document.getElementById("anim-controls").style.display="none",document.getElementById("log-panel").style.display="none",document.getElementById("student-menu").style.width=o.style.width,document.getElementById("clustering-replay-comment").innerHTML="&nbsp",Fe=!(Ie=!0),e.style.display="block",re.style.display="block",r&&(r.style.display="block"),K.style("display","block"),K.style("opacity",1),Q.style("display","block"),Q.style("opacity",1),Yt(!0),K.on("mouseover",bt).on("mouseout",kt),o.innerHTML=q.cluster,o.removeEventListener("click",tn),o.addEventListener("click",nn)}function nn(){Ie=!1,e.style.display="none",re.style.display="none",r&&(r.style.display="none"),U.selectAll(".hull").remove(),U.selectAll(".text").remove(),U.selectAll("rect").remove(),document.getElementById("student-menu").style.width=pe+"px",o.innerHTML=q.graph,o.removeEventListener("click",nn),o.addEventListener("click",tn),Z.stop(),K.on("mouseover",null).on("mouseout",null).on("contextmenu",null).call(U.drag().on("start",null).on("drag",null).on("end",null)),Ze.clusterId=Date.now(),Le=!(j={}),ye=1,Te=void(we=0),document.getElementById("clustering-replay-comment").innerHTML="&nbsp";var t='<p id="cluster-text">'+q.numclusters+"</p>";setTimeout(function(){var e;me?(document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("cluster-text").innerHTML=t,document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("anim-controls").style.display="block",document.getElementById("log-panel").style.display="block",me.removeAttribute("disabled"),me.noUiSlider.set(1),me.style.display="block"):(e=function(){var e=document.getElementById("anim-controls");e.appendChild(document.createTextNode(q.runkmeans));var t=document.createElement("p");t.innerHTML="&nbsp",t.id="clustering",e.appendChild(t);var n=document.createElement("p");n.innerHTML="&nbsp",n.id="dragdrop",n.style.marginTop="-12px",e.appendChild(n);t=document.createElement("button");t.id="play-pause",t.style.marginLeft="5px",t.style.marginRight="5px",t.innerHTML="&#9654",t.className="btn btn-secondary",t.addEventListener("click",In),t.disabled=!0;n=document.createElement("button");n.id="play-step",n.style.marginLeft="5px",n.innerHTML="&#9654&nbsp&nbsp&#9614",n.className="btn btn-secondary",n.addEventListener("click",function(e){3==ye&&(Te?(clearInterval(Te),Te=void 0,e.innerHTML="&#9654",me.removeAttribute("disabled")):wn())}.bind(this,t)),n.disabled=!0,e.appendChild(n),e.appendChild(t);t=document.createElement("button");return t.id="stop",t.style.marginTop="5px",t.style.marginLeft="5px",t.innerHTML=q.reset,t.className="btn btn-secondary",t.addEventListener("click",En),e.appendChild(t),e}(),function(t,e){me=document.getElementById("cluster-slider"),X.create(me,{start:[1],handles:1,range:{min:1,max:3},step:1,orientation:"vertical",direction:"rtl",pips:{mode:"steps",stepped:!0,density:100,filter:function(){return 1},format:{to:function(e){switch(e){case 1:return q.showcentroids;case 2:return q.removegraph;case 3:return t;default:return""}},from:function(){return""}}}}),me.noUiSlider.on("update",Rn),me.style="margin-top: 20px;";var n=o.getBoundingClientRect().height,e=e.getBoundingClientRect().height;me.style.height=J-n-e-120+"px";n=document.createElement("input");n.type="radio",n.name="centroid-type",n.value="geometric",n.style="margin-top: 40px",n.checked=!0,n.addEventListener("click",Fn);e=document.createElement("label");e.appendChild(n),e.appendChild(document.createTextNode(q.geometrics)),me.appendChild(e),0==Object.keys(I).length&&((n=document.createElement("input")).type="radio",n.name="centroid-type",n.value="decomposed",n.addEventListener("click",Fn),(e=document.createElement("label")).appendChild(n),e.appendChild(document.createTextNode(q.decomposed)),me.appendChild(e))}(t,e),Gn()),Pn()},Ke/2)}function rn(e){an(e)&&($e=Date.now(),P.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+e).attr("points",Yn(U.event.x,U.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Ae[e].colour).style("opacity",.5))}function on(e){U.select("#dragged-"+e).attr("points",Yn(U.event.x,U.event.y))}function ln(e,t,n){if(U.selectAll(".dragged-centroid").remove(),an(e))if(Date.now()-$e<300)tr(F[e],e,!1);else{Ve||function(){for(var e in ae)if(!(0<=e)){dt[e]={};for(var t=0;t<ae[e].length;t++)for(var n in ae[e][t].members){n=R[ae[e][t].members[n].id];dt[e][n]=t}}}();var r=cn();if(0==Object.keys(dt[r]).length)for(var o=0;o<ae[r].length;o++)for(var l in ae[r][o].members){l=R[ae[r][o].members[l].id];dt[r][l]=o}var i,s=Qn(U.event);for(i in dt)i<=r&&(dt[i][e]=s);dn(r,t,n),Ve=!0,sn(r),function(e){for(var t={clusterCoords:[],members:[]},n=0;n<ut.length;n++){var r,o=ut[n]||Se[n];for(r in t.clusterCoords[n]=_n(o),t.clusterCoords[n].num=n,dt[e])dt[e][r]==n&&(t.members[t.members.length]={id:F[r],num:n})}t.iteration=e,t.clusterId=Ze.clusterId,t.coordsid=_,Bt(c,t)}(r)}}function sn(e){if(!(0<=e)&&dt[e]&&0!=Object.keys(dt[e]).length){for(var t=function(e){var t,n,r,o=0,l=0,i=0,s=[];for(r=0;r<Se.length;r++){for(var a in Ne)Ne[a].ci==r&&dt[e][a]==Ne[a].ci?o++:Ne[a].ci==r&&dt[e][a]!=Ne[a].ci?l++:dt[e][a]==r&&dt[e][a]!=Ne[a].ci&&i++;t=o/(o+l),n=o/(o+i),s[r]={tp:o,fp:l,fn:i,precision:t,recall:n,f1:t+n==0?0:2*t*n/(t+n),fhalf:t+n==0?0:1.25*t*n/(.25*t+n),f2:t+n==0?0:5*t*n/(4*t+n)},i=l=o=0}for(r=0;r<s.length;r++)o+=s[r].tp,l+=s[r].fp,i+=s[r].fn;return t=o/(o+l),n=o/(o+i),s[s.length]={tp:o,fp:l,fn:i,precision:t,recall:n,f1:t+n==0?0:2*t*n/(t+n),fhalf:t+n==0?0:1.25*t*n/(.25*t+n),f2:t+n==0?0:5*t*n/(4*t+n)},s}(e),n=q.manualcluster+"<br>",r=0;r<ut.length;r++)if(ut[r]){var o,l=ut[r].x-Y/2,i=ut[r].y-J/2,l=Math.sqrt(l*l+i*i),i=Se[r].colour;for(o in n+=q.disttocluster+' <span style="color:'+i+'">'+i+"</span>: "+Math.round(l)+"<br>"+q.cluster+" "+i+" "+q.members+": [",dt[e])dt[e][o]==r&&(n+=o+", ");-1!=n.indexOf(",",n.length-3)&&(n=n.slice(0,-2)),n+="]<br>",tt&&(n+=q.precision+": "+t[r].precision.toFixed(4)+"<br>",n+=q.recall+": "+t[r].recall.toFixed(4)+"<br>",n+=q.f1+": "+t[r].f1.toFixed(4)+"<br>",n+=q.fhalf+": "+t[r].fhalf.toFixed(4)+"<br>",n+=q.f2+": "+t[r].f2.toFixed(4)+"<br>")}var s=ge.innerHTML.split("<br><br>"),a=s[0].split("<br>");for(ge.innerHTML="",r=0;r<a.length&&!a[r].startsWith(q.manualcluster);r++)ge.innerHTML+=a[r]+"<br>";for(tt&&(r=t.length-1,n+=q.totalmeasures+"<br>",n+=q.precision+": "+t[r].precision.toFixed(4)+"<br>",n+=q.recall+": "+t[r].recall.toFixed(4)+"<br>",n+=q.f1+": "+t[r].f1.toFixed(4)+"<br>",n+=q.fhalf+": "+t[r].fhalf.toFixed(4)+"<br>",n+=q.f2+": "+t[r].f2.toFixed(4)+"<br>"),ge.innerHTML+=n+"<br>",r=1;r<s.length;r++)ge.innerHTML+=s[r]+"<br><br>"}}function an(e){if(document.getElementById("replayer").innerHTML==q.convergence&&et==T){var t,n=Ne[e].ci,r=0;for(t in Ne)Ne[t].ci==n&&r++;var o=cn(),l=0;if(dt[o])for(t in n=dt[o][e],dt[o])dt[o][t]==n&&l++;return 1==r&&l<=1?void 0:1!=l}}function cn(){var e=ge.innerHTML.split("<br>");return e[2]&&e[2].startsWith(q.iteration)?parseInt(e[2].split(" ")[1]):null}function dn(e,t,n){for(var r,o,l,i=[],s=[],a=0;a<ae[e].length;a++)for(r in i[a]={},s[a]=[],dt[e])dt[e][r]==a&&(o=Ne[r].x,l=Ne[r].y,i[a][o+"_"+l]={x:o,y:l,colour:Se[a].colour},s[a][s[a].length]=[o,l]);var c=0==document.getElementsByClassName("manual-centroid").length;for(U.selectAll(".manual-hull").remove(),a=0;a<i.length;a++)en(i[a],-1*(a+1),!0,c),ut[a]=Nn(s[a]);if(t)for(t[n.did]||(t[n.did]={}),t[n.did][n.gid]||(t[n.did][n.gid]={}),t[n.did][n.gid][n.cid]||(t[n.did][n.gid][n.cid]={}),t[n.did][n.gid][n.cid][e]||(t[n.did][n.gid][n.cid][e]=[]),a=0;a<ut.length;a++)if(ut[a]){var d=[];for(r in dt[e])dt[e][r]==a&&(d[d.length]={id:F[r],num:a});t[n.did][n.gid][n.cid][e][a]={centroidx:ut[a].x,centroidy:ut[a].y,members:d}}(c?function(){U.selectAll(".manual-centroid").remove();for(var e,t,n=0;n<ut.length;n++){if(!ut[n])return;e=ut[n].x,t=ut[n].y,P.append("line").attr("class","manual-centroid").attr("id","manual1-"+n).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("stroke",Se[n].colour).style("stroke-width","5px").style("opacity",0).on("click",un).on("click.centroidClick",tr.bind(this,-1*(n+1),n,!0)).on("mouseover",Mn.bind(this,n,!0)),P.append("line").attr("class","manual-centroid").attr("id","manual2-"+n).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("stroke",Se[n].colour).style("stroke-width","5px").style("opacity",0).on("click",un).on("click.centroidClick",tr.bind(this,-1*(n+1),n,!0)).on("mouseover",Mn.bind(this,n,!0))}U.selectAll(".manual-centroid").transition().duration(Ke).style("opacity",.5),U.selectAll(".manual-hull").transition().duration(Ke).style("stroke-opacity",1).style("fill-opacity",He)}:function(){for(var e,t,n=0;n<ut.length;n++){if(!ut[n])return U.selectAll(".manual-centroid").remove();e=ut[n].x,t=ut[n].y,U.select("#manual1-"+n).transition().duration(Ke).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("display","block"),U.select("#manual2-"+n).transition().duration(Ke).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("display","block")}})(),P.selectAll(".centroid").raise(),P.selectAll(".clustering-centroid").raise(),P.selectAll(".manual-centroid").raise()}function un(){U.event.stopPropagation()}function mn(e,t){for(var n in e)e[n].x*=Ze.distance,e[n].x+=Ze.originalx,e[n].y*=Ze.distance,e[n].y+=Ze.originaly,t&&(e[n].x-=Ze.centre.x,e[n].x*=Ze.scale,e[n].x+=Y/2,e[n].y-=Ze.centre.y,e[n].y*=Ze.scale,e[n].y+=J/2)}function yn(){var e=document.getElementById("replay-select"),e={userid:e.options[e.selectedIndex].value.split("_")[0].split("-")[0],coordsid:_,clusterid:Ze.clusterId};Bt(s,e),ot=e}function pn(){var e,t;!confirm(q.delconfirm)||-1<(e=document.getElementById("replay-select")).selectedIndex&&(0<(t=e.options[e.selectedIndex].value).length&&(Bt(i,t.replace("-","_")),e.options[e.selectedIndex]=null,gn()))}function gn(){P&&setTimeout(function(){for(var e in P.remove(),fn(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;",st)document.body.removeChild(st[e].textbox),document.body.removeChild(st[e].button);st={}},500),ae=void 0,Ne=null,vn(),document.getElementById("clustering-replay-comment").innerHTML="&nbsp",document.getElementById("replay-stop").style.opacity=0,document.getElementById("replay-pause").style.opacity=0,document.getElementById("replay-back").style.opacity=0,document.getElementById("replay-forward").style.opacity=0,document.getElementById("delete-button").style.opacity=0,document.getElementById("prediction-label").style.opacity=0,document.getElementById("prediction-box").style.opacity=0;var e=document.getElementById("replay-select");-1<e.selectedIndex&&(e.options[e.selectedIndex].selected=!1)}function fn(){ge.readOnly=!1,ge.innerHTML="",setTimeout(function(){ge.readOnly=!0},300)}function vn(){var e=document.getElementById("replay-pause");e.innerHTML="&#9654",e.value="play",clearInterval(Te),Te=void 0}function hn(){var e;ae&&("play"==(e=document.getElementById("replay-pause")).value?(e.innerHTML="&#9613&#9613",bn(!(e.value="pause")),Te=setInterval(bn.bind(this,!1),1200)):vn())}function bn(e){if(ae){e&&vn();e=++we-1;return de<we&&ae[-1]&&!ae[(e=de-we+1)-1]||de<e?(we--,void vn()):void(1==we?(ye=2,_e=!(Le=!0),Dn()):2==we?(zn(),kn(e-1,!1,!0)):kn(e-1,!1,!1))}}function xn(){var e;!ae||!ce||we-1<0||(vn(),e=de<--we?de-we+1:we-1,0==we?(ye=1,qn(),Le=!1,ge.innerHTML=ge.innerHTML.slice(ge.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):1==we?(Ne=null,Dn(),ge.innerHTML=ge.innerHTML.slice(ge.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):kn(e-1,!(Ne=null),2==we))}function kn(e,t,n){var r=[],o={},l={};for(u=0;u<ae[e].length;u++,l={}){for(var i in P.selectAll("#hull-"+u).remove(),Se[u].x=ae[e][u].centroidx,Se[u].y=ae[e][u].centroidy,ae[e][u].members){var s=ae[e][u].members[i].x,a=ae[e][u].members[i].y,i=R[ae[e][u].members[i].id];l[(Ae[i].x=s)+"_"+(Ae[i].y=a)]={x:s,y:a,colour:Se[u].colour},o[i]=u}r[u]=l}if(mn(Se,!0),n)Bn();else{for(mn(Ae,!1),u=0;u<r.length;u++)mn(r[u],!0),en(r[u],u,!1,!1);jn(Ke)}if(Un(ce[2],ce[0],ce[1],Ke),P.selectAll(".centroid").raise(),P.selectAll(".clustering-centroid").raise(),function(e){if(!e||0<e)return P.selectAll(".manual-centroid").remove(),P.selectAll(".manual-hull").remove();Ve&&dn(e,null,null)}(e),t)ge.innerHTML=ge.innerHTML.slice(ge.innerHTML.indexOf("<br><br>")+8);else{for(var c in o)Ne[c].ci=o[c];Sn(e),sn(e)}if(e<0)if(document.getElementById("replayer").innerHTML=q.convergence,document.getElementById("replayer").style.color="green",tt){for(var d=document.getElementById("replay-select").options,u=0;u<d.length;u++)if(d[u].selected){d[u].value.split("-")[0]==T&&(document.getElementById("replaydragdrop").innerHTML=q.dragon);break}}else document.getElementById("replaydragdrop").innerHTML=q.dragon;else document.getElementById("replayer").innerHTML=q.iteration+" "+e,document.getElementById("replayer").style.color="black",document.getElementById("replaydragdrop").innerHTML=q.dragoff}function En(){for(var e in Le=!1,we=0,clearInterval(Te),Te=void 0,Ze.clusterId=Date.now(),me.removeAttribute("disabled"),document.getElementById("clustering-replay-comment").innerHTML="&nbsp",3==ye?(me.noUiSlider.set(2),setTimeout(function(){me.noUiSlider.set(1),ye=1},Ke)):(me.noUiSlider.set(1),ye=1),document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("num-clusters")&&(document.getElementById("num-clusters").readOnly=!1,document.getElementById("num-clusters").value=""),U.selectAll(".clustering-centroid").transition(W).style.display="none",U.selectAll(".cluster-hull").transition(W).style.display="none",setTimeout(function(){U.selectAll(".clustering-centroid").remove(),U.selectAll(".cluster-hull").remove(),fn()},Ke),Ne)Ne[e].ci=void 0}function In(){3==ye&&(Te?(clearInterval(Te),Te=void 0,this.innerHTML="&#9654",me.removeAttribute("disabled")):(Te=setInterval(wn,1e3),this.innerHTML="&#9613&#9613",me.setAttribute("disabled",!0)))}function Ln(){var e=document.getElementById("clustering-replay-comment"),i=document.createElement("input");i.type="text",i.className="form-control custom-control mr-1",i.style.width="160px",i.style.marginRight="10px",i.id="clustering-replay-comment-text",j[0]?i.value=j[0]:i.placeholder=q.clusteringname,e.appendChild(i);var t=document.createElement("button");t.innerHTML=q.clusteringnamebutton,t.className="btn btn-primary",e.appendChild(t),t.addEventListener("click",function(){if(et==T&&""!=i.value){var e={coordsid:_,clusterid:Ze.clusterId,studentid:0,remark:i.value};Bt(m,e);var t=document.getElementById("replay-select");if(t){for(var n,r=0;r<t.options.length;r++)if(t.options[r].selected){n=t.options[r].value.split("_");break}var o=n[0],l=n[1],e=n[2];z[o][l][e].comments[0]=i.value}}})}function wn(){if(0==we){Le=!0,Ln();var e=document.getElementById("num-clusters"),t=parseInt(e.value);(isNaN(t)||t<2)&&(t=3);var n,r,o,l,i={};for(n in Ae)i[Ae[n].x+"_"+Ae[n].y]=1;for(;t>Object.keys(i).length;)t--;for(e.value=t,e.readOnly=!0,Se=[],Oe=null,o=r=0;r<t;r++)if(o<Ee.length)Se[r]=Tn(null,Ee[o++]);else{for(;!l;)l=be[Math.floor(G.random()*be.length)],l=Ee.includes(l)?void 0:l;Se[r]=Tn(null,l)}Bn(),document.getElementById("clustering").innerHTML=q.randcentroids,document.getElementById("dragdrop").innerHTML=q.dragoff,document.getElementById("clustering").style.color="black";e=Sn(we);Ze.iteration=we,On(e)}else!function(e){if(document.getElementById("clustering").innerHTML!=q.convergence)if(0!=Object.keys(Ne).length){var t,n,r,o,l=q.iteration+": "+e;for(t in Ne)Ne[t].ci=Qn(Ne[t]);var i=[];for(n=0;n<Se.length;n++)i[n]=An(n);Oe=Se,Se=i;var s=!1;if(Oe){var a=0;for(n=0;n<Se.length;n++)r=Oe[n].x-Se[n].x,o=Oe[n].y-Se[n].y,a+=Math.sqrt(r*r+o*o);a<=Ue&&(l=q.convergence,document.getElementById("clustering").style.color="green",s=!0)}document.getElementById("clustering").innerHTML=l,document.getElementById("dragdrop").innerHTML=0<e&&!s?q.dragon:q.dragoff;l=Sn(e);Ze.iteration=s?-1:e,On(l)}else document.getElementById("clustering").innerHTML=q.convergence}(we),jn(Ke);we++,document.getElementById("clustering").innerHTML==q.convergence&&(clearInterval(Te),Te=void 0,me.removeAttribute("disabled"),document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0)}function Tn(e,t){var n,r,o,l,i=Y-100,s=J-100,a=0;if(e)for(;a<100;)n=Math.floor(Math.random()*(i-100)+100),r=Math.floor(Math.random()*(s-100)+100),o=n-e.x,l=r-e.y,a=Math.sqrt(o*o+l*l);else n=Math.floor(Math.random()*(i-100)+100),r=Math.floor(Math.random()*(s-100)+100);return{x:n,y:r,colour:t}}function Bn(){U.selectAll(".clustering-centroid").remove();for(var e,t,n=0;n<Se.length;n++)e=Se[n].x,t=Se[n].y,P.append("line").attr("class","clustering-centroid").attr("id","cluster1-"+n).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("stroke",Se[n].colour).style("stroke-width","5px").on("click",un).on("click.centroidClick",tr.bind(this,-1*(n+1),n,!0)).on("mouseover",Mn.bind(this,n,!1)),P.append("line").attr("class","clustering-centroid").attr("id","cluster2-"+n).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("stroke",Se[n].colour).style("stroke-width","5px").on("click",un).on("click.centroidClick",tr.bind(this,-1*(n+1),n,!0)).on("mouseover",Mn.bind(this,n,!1))}function Mn(e,t){Q.remove(),Fe=!(je=!(_e=!0)),P.on("click",Cn);var n,r={};if(t){var o=cn();for(n in dt[o])dt[o][n]==e&&(r[n]=n)}else for(n in Ne)Ne[n].ci==e&&(r[n]=n);for(var t=Object.keys(r).length,l={},i=0;i<ne.nodes.length;i++)ne.nodes[i].visible||(l[ne.nodes[i].id]=1);t=function(e,t,n){var r,o,l,i,s={};for(r in e)for(i=oe[0];i<ne.edges[r].length&&i<=oe[1];i++)l="string"==typeof(l=ne.edges[r][i]).source?(o=parseInt(l.source),parseInt(l.target)):(o=l.source.id,l.target.id),t[o]||t[l]||(s[l=o+"_"+l]?s[l][r]?s[l][r]++:s[l][r]=1:(s[l]={},s[l][r]=1));var a,c,d=[];for(a in s)if(Object.keys(s[a]).length==n){var u=Number.MAX_SAFE_INTEGER;for(c in s[a])u>s[a][c]&&(u=s[a][c]);var m=a.split("_");d[d.length]=lt?{source:Kt(m[0]),target:Kt(m[1]),weight:u,colour:"black"}:{source:m[0],target:m[1],weight:u,colour:"black"}}for(i=0;i<ne.links.length;i++)d[d.length]=ne.links[i];return d}(r,l,t);K.style("display","block").style("opacity",1).on("mouseover",bt).on("mouseout",kt),lt||Z.force("link").links(t),ht(t),Q.on("mouseover",Hn).on("mouseout",kt),Z.restart(),setTimeout(function(){Z.stop(),Q.lower(),U.selectAll(".cluster-hull").lower()},10)}function Cn(){Fe=!(je=!(_e=!1)),Q.remove(),K.style("display","none").on("mouseover",null).on("mouseout",null),P.on("click",null)}function Hn(e){"black"==e.colour&&(Q.on("mouseover",null),K.on("mouseover",null).on("mouseout",null),U.selectAll(".clustering-centroid").on("mouseover",null),bt(e.source,!1),Re=!0,bt(e.target,!0),Re=!1)}function An(e){var t,n=[],r={};for(t in Ne)Ne[t].ci==e&&(n[n.length]=[Ne[t].x,Ne[t].y],r[Ne[t].x+"_"+Ne[t].y]={x:Ne[t].x,y:Ne[t].y,colour:Se[e].colour});if(P.selectAll("#hull-"+e).remove(),en(r,e,!1,!1),P.selectAll(".centroid").raise(),P.selectAll(".clustering-centroid").raise(),0==Object.keys(r).length)return Tn(Se[e],Se[e].colour);var o=Nn(n);return o.colour=Se[e].colour,o}function Nn(e){if(0==e.length)return null;for(var t=0,n=0,r=0;r<e.length;r++)t+=e[r][0],n+=e[r][1];return{x:t/e.length,y:n/e.length}}function Sn(e){var t=q.numstudents+": "+Object.keys(Ne).length+"<br>"+q.numofclusters+": "+Se.length+"<br>"+q.iteration+": "+e+"<br>";document.getElementById("clustering")&&document.getElementById("clustering").innerHTML==q.convergence&&(t+='<span style="color:green">'+q.convergence+"</span><br>");for(var n,r,o,l=[],i=0;i<Se.length;i++){for(r in n=Se[i].x-Y/2,o=Se[i].y-J/2,n=Math.sqrt(n*n+o*o),o=Se[i].colour,t+=q.disttocluster+' <span style="color:'+o+'">'+o+"</span>: "+Math.round(n,2)+"<br>"+q.cluster+" "+o+" "+q.members+": [",l[i]=[],Ne)Ne[r].ci==i&&(t+=r+", ",l[i][l[i].length]=r);-1!=t.indexOf(",",t.length-3)&&(t=t.slice(0,-2)),t+="]<br>"}return ge.innerHTML=(t+="<br>")+ge.innerHTML,l}function On(e){for(var t,n,r={clusterCoords:[]},o=0;o<e.length;o++)for(r.clusterCoords[o]=_n(Se[o]),r.clusterCoords[o].num=o,t=0;t<e[o].length;t++)n=_n(Ne[e[o][t]]),e[o][t]={id:F[e[o][t]],num:o,x:n.x,y:n.y};r.members=e,r.iteration=Ze.iteration,r.clusterId=Ze.clusterId,r.coordsid=_,r.usegeometric=rt?1:0,(0!=oe[0]||oe[1]!=ne.maxSession)&&r.iteration<0&&(r.iteration=we),Bt(l,r)}function _n(e){var t=(e.x-Y/2)/Ze.scale+Ze.centre.x,e=(e.y-J/2)/Ze.scale+Ze.centre.y;return{x:t=(t-Ze.originalx)/Ze.distance,y:e=(e-Ze.originaly)/Ze.distance}}function jn(e){for(var t,n,r=0;r<Se.length;r++)t=Se[r].x,n=Se[r].y,U.select("#cluster1-"+r).transition().duration(e).attr("x1",t-14).attr("y1",n-14).attr("x2",t+14).attr("y2",n+14),U.select("#cluster2-"+r).transition().duration(e).attr("x1",t+14).attr("y1",n-14).attr("x2",t-14).attr("y2",n+14)}function Fn(){rt="geometric"==this.value,P.selectAll(".centroid").remove();var e,t=[],n=0;for(e in Ae)t[n++]={value:e,selected:!0,colour:Ae[e].colour};(rt?$t:Vt)(t),nn()}function Rn(e,t){var n,r,o;switch(parseInt(e[t])){case 1:if(3==ye){me.noUiSlider.set(2);break}if(ye=1,qn(),!Le)for(r in n=document.getElementsByName("centroid-type"))n[r].disabled=!1;break;case 2:for(r in ye=2,Dn(),n=document.getElementsByName("centroid-type"))n[r].disabled=!0;document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("dragdrop").innerHTML==q.dragon&&(document.getElementById("dragdrop").innerHTML="--");break;case 3:if(1==ye){me.noUiSlider.set(2);break}ye=3,zn(),Le||(o='<input type="text" placeholder="'+q.numclusters+'" id="num-clusters" size="8" pattern="[0-9]{1,2}">',document.getElementById("cluster-text").innerHTML=o),document.getElementById("play-pause").disabled=!1,document.getElementById("play-step").disabled=!1,document.getElementById("clustering").innerHTML==q.convergence&&(document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0),"--"==document.getElementById("dragdrop").innerHTML&&(document.getElementById("dragdrop").innerHTML=q.dragon)}}function qn(){Yt(!1),K.on("mouseover",null).on("mouseout",null),Un(1,0,0,Ke),setTimeout(function(){U.selectAll(".centroid").raise()},100)}function Dn(){K.transition(W).style("opacity",0),Q.transition(W).style("opacity",0),U.selectAll(".clustering-centroid").transition(W).style("opacity",0),U.selectAll(".cluster-hull").transition(W).style("opacity",0),setTimeout(function(){K.style("display","none"),Q.style("display","none"),U.selectAll(".clustering-centroid").style("display","none"),U.selectAll(".cluster-hull").style("display","none")},Ke),!Le&&document.getElementById("cluster-text")&&(document.getElementById("cluster-text").innerHTML=q.numclusters);var e=function(){var e,t=[];if(ie)return function(){var e,t=[],n=0,r=0;for(e in ae)if(!(0<=e&&1!=e))for(var o in ae[e])for(var l in ae[e][o].members)n=(n=ae[e][o].members[l].x)*L+Ze.originalx,r=(r=ae[e][o].members[l].y)*L+Ze.originaly,t[t.length]=[n,r];var i=Wn(t);if(null===i)return null;var s,a,c,d,u,m=[i.x,i.y],y=0,p=0;for(u=0;u<t.length;u++)s=Math.abs(t[u][0]-m[0]),a=Math.abs(t[u][1]-m[1]),y<s&&(y=s,c=u),p<a&&(p=a,d=u);if(void 0===d&&void 0===c)return m[2]=1,m;var g=t[c][0]-m[0]+Y/2,f=t[c][1]-m[1]+J/2,i=Xn(g,f,Y/2,J/2);g=t[d][0]-m[0]+Y/2,f=t[d][1]-m[1]+J/2;f=Xn(g,f,Y/2,J/2);return m[2]=i<f?i:f,m[2]*=.9,m}();for(e in Ae)t[t.length]=[Ae[e].x,Ae[e].y];var n=Wn(t);if(null===n)return null;var r,o,l,i,s=[n.x,n.y],a=0,c=0;for(e in Ae)r=Math.abs(Ae[e].x-s[0]),o=Math.abs(Ae[e].y-s[1]),a<r&&(a=r,l=e),c<o&&(c=o,i=e);if(void 0===i&&void 0===l)return s[2]=1,s;var d=Ae[l].x-s[0]+Y/2,u=Ae[l].y-s[1]+J/2,n=Xn(d,u,Y/2,J/2);d=Ae[i].x-s[0]+Y/2,u=Ae[i].y-s[1]+J/2;u=Xn(d,u,Y/2,J/2);return s[2]=n<u?n:u,s[2]*=.9,s}();null!==e&&(Ze.scale=e[2],ce=e,setTimeout(function(){Un(e[2],e[0],e[1],Ke)},Ke/2))}function zn(){U.selectAll(".clustering-centroid").transition(W).style("display","block").style("opacity",1),U.selectAll(".cluster-hull").transition(W).style("display","block").style("opacity",1),U.selectAll(".clustering-centroid").raise()}function Un(e,t,n,r){var o,l,i,s=Y/2,a=J/2;if(!Ne)for(i in Ne={},Ae)Ne[i]={x:0,y:0};for(i in Ze.centre={x:t,y:n},Ae)o=((m=Ae[i].x)-t)*e,l=((y=Ae[i].y)-n)*e,y=1==e&&0==t&&0==n?(m=t+o,n+l):(m=s+o,a+l),l=(Ne[i].x=m)+","+((Ne[i].y=y)-14)+" "+(m+14)+","+(y+14)+" "+(m-14)+","+(y+14),U.select("#centroid-"+i).transition().duration(r).attr("points",l);var c,d;for(i in ct){var u=(c=ct[i].x,d=ct[i].y,c*=Ze.distance,c+=Ze.originalx,d*=Ze.distance,d+=Ze.originaly,c-=Ze.centre.x,c*=Ze.scale,c+=Y/2,d-=Ze.centre.y,d*=Ze.scale,{x:c,y:d+=J/2}),m=u.x,y=u.y;U.select("#server-centroid-"+i).transition().duration(r).attr("cx",m).attr("cy",y)}}function Wn(e){if(0==e.length)return null;if(1==e.length)return{x:e[0][0],y:e[0][1]};for(var t,n=0,r=0,o=Y,l=J,i=0;i<e.length;i++)n<(t=e[i][0])&&(n=t),t<o&&(o=t),r<(t=e[i][1])&&(r=t),t<l&&(l=t);return{x:(n+o)/2,y:(r+l)/2}}function Xn(e,t,n,r){n=e-n,r=t-r,n=((0<n?Y:0)-Y/2)/n,r=((0<r?J:0)-J/2)/r;return isFinite(n)&&isFinite(r)&&n<=r||isFinite(n)&&!isFinite(r)?n:isFinite(r)?r:1}function Gn(){var e=document.getElementById("log-panel");e.style.width=p+"px";var t=document.createElement("button");t.innerHTML=q.copy,t.className="btn btn-secondary mb-1",t.addEventListener("click",function(){window.getSelection().selectAllChildren(ge),document.execCommand("copy")}),De?t.style.marginLeft="10px":(t.style.position="absolute",t.style.right=p-40+"px"),e.appendChild(t);t=document.createElement("button");t.innerHTML=q.print,t.className="btn btn-secondary mb-1",t.addEventListener("click",function(){var e=window.open();e.document.write("<html><head></head><body>"),e.document.write(ge.innerHTML),e.document.write("</body></html>"),e.print(),e.close()}),De?t.style.marginLeft="10px":(t.style.position="absolute",t.style.right=p-100+"px"),e.appendChild(t),(ge=document.createElement("div")).readOnly=!0,ge.style.overflow="scroll",ge.style.width="200px",ge.style.height=J+"px",ge.style.resize="none",ge.style.border="2px solid black",De||(ge.style.position="absolute",ge.style.right="6px",ge.style.top="120px"),e.appendChild(ge)}function Pn(){for(var e in Ae)P.append("polygon").attr("class","centroid").attr("id","centroid-"+e).attr("points",Yn(Ae[e].x,Ae[e].y)).style("stroke","black").style("stroke-width","3px").style("fill",Ae[e].colour).call(U.drag().on("start",Jn.bind(this,e)).on("drag",Zn.bind(this,e)).on("end",Kn.bind(this,e))).on("mouseout",$n).on("mouseover",er.bind(this,e)).on("click",un).on("click.centroidClick",tr.bind(this,F[e],e,!1));if(at)for(e in ct){var t=ct[e].x*Ze.distance+Ze.originalx,n=ct[e].y*Ze.distance+Ze.originaly;P.append("circle").attr("class","server-centroid").attr("id","server-centroid-"+e).attr("r",5).attr("cx",t).attr("cy",n).style("fill","black")}}function Yn(e,t){return e+","+(t-14)+" "+(e+14)+","+(t+14)+" "+(e-14)+","+(t+14)}function Jn(e){Vn()&&($e=Date.now(),P.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+e).attr("points",Yn(U.event.x,U.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Ae[e].colour).style("opacity",.5))}function Zn(e){Vn()&&U.select("#dragged-"+e).attr("points",Yn(U.event.x,U.event.y))}function Kn(e){if(U.selectAll(".dragged-centroid").remove(),Vn())if(Date.now()-$e<300)tr(F[e],e,!1);else{Ne[e].ci=Qn(U.event);for(var t=[],n=0;n<Se.length;n++)t[n]=An(n);Oe=Se,Se=t,jn(Ke);e=q.iteration+": "+we;document.getElementById("clustering").innerHTML=e,document.getElementById("dragdrop").innerHTML=q.dragon;e=Sn(we);Ze.iteration=we++,On(e)}}function Qn(e){for(var t,n,r=Number.MAX_SAFE_INTEGER,o=-1,l=0;l<Se.length;l++)t=e.x-Se[l].x,n=e.y-Se[l].y,(n=Math.sqrt(t*t+n*n))<r&&(r=n,o=l);return o}function Vn(){if(Se&&document.getElementById("clustering")&&document.getElementById("clustering").innerHTML!=q.convergence){for(var e in Ne)if(void 0===Ne[e].ci)return;return 3==ye?1:void 0}}function $n(){_e||(U.selectAll(".text").remove(),U.selectAll("rect").remove(),Le&&(ie||3==ye)&&null!==cn()&&(K.style("display","none").style("opacity",0),Q.remove()))}function er(t){if(!_e){U.selectAll(".text").remove(),U.selectAll("rect").remove();var e=P.append("rect"),n=[0],r=1==ye?Ae:Ne,o=t;h.forEach(function(e){e.id==t&&(o=1==ze?e.firstname+" "+e.lastname:e.id)});var l=1==ze?70:30,i=P.append("text").attr("class","text").attr("id","t-"+t).attr("y",r[t].y+32).attr("dy",".40em").style("pointer-events","none").text(o).call(xt,l,r[t].x-(6+l)/2+8,n),s=18*n[0]+16;if(s+r[t].y+10>=J&&i.attr("y",J-s-(J-r[t].y)).text(o).call(xt,l,r[t].x-(6+l)/2+8,n),e.attr("id","r-"+t).attr("x",r[t].x-(6+l)/2).attr("y",s+r[t].y+10<=J?r[t].y+16:J-s-16-(J-r[t].y)).attr("width",16+l).attr("height",s).style("stroke","black").style("fill","yellow"),Le&&(ie||3==ye)&&null!==cn()){Q.remove();for(var a={},c=0;c<ne.nodes.length;c++)ne.nodes[c].visible||(a[ne.nodes[c].id]=1);var d,u,m,y={};for(c=oe[0];c<ne.edges[t].length&&c<=oe[1];c++)m="string"==typeof(d=ne.edges[t][c]).source?(u=parseInt(d.source),parseInt(d.target)):(u=d.source.id,d.target.id),a[u]||a[m]||(y[m=u+"_"+m]?y[m]++:y[m]=1);var p,g=[],f=ne.edges[t][0].colour;for(d in y)p=d.split("_"),g[g.length]=lt?{source:Kt(p[0]),target:Kt(p[1]),weight:y[d],colour:f}:{source:p[0],target:p[1],weight:y[d],colour:f};for(c=0;c<ne.links.length;c++)g[g.length]=ne.links[c];lt||Z.force("link").links(g),ht(g),K.style("display","block").style("opacity",1),Z.restart(),setTimeout(function(){Z.stop(),K.lower(),Q.lower()},1)}}}function tr(t,e,n){var r,o,l,i,s,a,c,d;Le&&!document.getElementById("textbox-"+t)&&null!==cn()&&(!ie&&Le&&3!=ye||((r=document.createElement("textarea")).id="textbox-"+t,r.style.resize="both",r.style.position="absolute",j[t]&&(r.value=j[t]),et!=T&&(r.readOnly=!0),document.body.appendChild(r),o=r.getBoundingClientRect(),l=document.getElementsByTagName("svg")[0].getBoundingClientRect(),i=(n?Se:Ne)[e].x,s=i+o.width/2>=Y?i+l.x-o.width:i-o.width/2<=0?i+l.x:i+l.x-o.width/2,r.style.left=s+"px",e=(n?Se:Ne)[e].y,a=u.version40?U.event.y:e+220,r.style.top=a+"px",(c=document.createElement("button")).innerHTML=et==T?q.save:q.close,c.style.position="absolute",c.style.left=s+"px",c.style.top=a+o.height+"px",document.body.appendChild(c),r.focus(),st[t]={button:c,textbox:r},r.addEventListener("click",function(){this.parentNode.appendChild(this),c.parentNode.appendChild(c),this.focus()}),d=!1,r.addEventListener("mousedown",function(){d=!0}),r.addEventListener("mouseup",function(){d=!1}),r.addEventListener("mousemove",function(){d&&(o=this.getBoundingClientRect(),c.style.left=s+"px",c.style.top=a+o.height+"px")}),c.addEventListener("click",function(){var e;et==T&&(e={coordsid:_,clusterid:Ze.clusterId,studentid:t,remark:r.value},""!=r.value&&r.value!=j[t]&&(j[t]=r.value,Bt(m,e))),document.body.removeChild(r),document.body.removeChild(c),delete st[t]})))}!function(e){v=e.logs,h=e.users,d=e.groups,y=e.members,b=e.mods,e.panelwidth,p=e.legendwidth,g=e.name,f=e.iframeurl,De=e.version36,ze=e.showstudentnames,x=e.positioning,k=e.positioning,E=e.nodecoords,I=e.links,w=e.courseid,T=e.userid,L=e.scale,B=e.graphs,M=e.alllinks,C=e.scales,H=e.changes,A=e.names,N=e.allmods,S=e.setnames,O=T,_=e.lastchange,j=e.comments,q=e.strings,a=e.coordsscript,l=e.clustersscript,m=e.commentsscript,c=e.manualscript,i=e.deletescript,D=e.sesskey,Qe=e.gotallnodes,ie=e.replaying,at=e.debugcentroids,ct=e.centroids,tt=e.isresearcher,et=T,z=e.replaydata,s=e.predictionscript,lt=e.uselsa,ot=null,e.predictionanalysis&&(t=e.predictionanalysis.split("_"),ot={userid:t[0],coordsid:t[1],clusterid:t[2]}),U=window.dataDrivenDocs,X=window.noUiSlider;var t=window.mersenneTwister;if(G=new t(259),xe=0,be=["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"],We=Date.now()+3e3,Ke=1e3,W=U.transition().duration(Ke).ease(U.easeLinear),pe=120,te=1e-4,Ye=Ft,Be=!($=Ue=1),Me=220,He=.15,Ce=U.curveCatmullRomClosed,rt=!0,ve={},Ze={},st={},ke={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"},Ee=["blue","red","orange","green","yellow","brown","purple","magenta","cyan"],le=x?0:36,Y=window.innerWidth-pe-p-150,J=window.innerHeight-le-90,Je=Math.min(Y,J)<450?6:8,it=10,F={},h.forEach(function(e){F[e.id]=e.realId}),mt(),lt){0<e.links.length&&e.links[0].label&&(it=4e3,E={}),(ne={nodes:e.nodecoords,links:e.links,edges:{},maxSession:0}).links.forEach(function(e){e.source=ne.nodes[e.source],e.target=ne.nodes[e.target],e.colour=ke.originalLinks});for(var n=[],r=Object.keys(ne.nodes),o=0;o<r.length;o++)ne.nodes[r[o]].entype&&(n[o]=ne.nodes[r[o]],n[o].colour=ke[n[o].entype]);return ne.nodes=n,x?gt():(setTimeout(function(){pt();var e=zt();Xt(),Ut(e),Gt()},it+100),function(){var e=Y/2,t=J/2;Ze.originalx=e,Ze.originaly=t;var e=ne.nodes,n=ne.links,t=U.forceLink(n).distance(function(e){return 1/e.value*500});P=U.select("#graph").append("svg").attr("width",Y).attr("height",J),Z=U.forceSimulation(e).force("link",t).force("charge",U.forceManyBody().strength(-250)).force("collide",U.forceCollide().radius(30)).force("center",U.forceCenter(Y/2,J/2)).force("x",U.forceX()).force("y",U.forceY()),K=P.selectAll(".node").data(e).enter().append("circle").attr("class","node").attr("r",Je).style("display",function(e){return e.visible?"block":"none"}).on("mouseover",bt).on("mouseout",kt),Q=P.selectAll(".link").data(n).enter().append("line").attr("class","link").style("stroke",ke.originalLinks).style("stroke-width",function(e){return e.value/3+"px"}),0<n.length&&n[0].label?(Z.on("tick",Lt),setTimeout(function(){Z.stop(),Tt(n),Ze.distance=L},it)):(Z.on("tick",It),setTimeout(function(){Z.stop()},100))}())}yt(),ie?(e=e.manualdata,x=!0,E={0:0,1:1,2:2},J=window.innerHeight-190,function(){var e=document.getElementById("slider"),t=document.createElement("p");t.innerHTML="&nbsp",t.id="replayer",t.style.marginTop="-20px",e.appendChild(t);t=document.createElement("p");t.innerHTML="&nbsp",t.id="replaydragdrop",t.style.marginTop="-12px",e.appendChild(t);t=document.createElement("button");t.id="replay-stop",t.innerHTML="&#9606",t.className="btn btn-secondary",t.addEventListener("click",gn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-pause",t.innerHTML="&#9654",t.value="play",t.className="btn btn-secondary",t.addEventListener("click",hn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-back",t.innerHTML="&#9614&#9664",t.className="btn btn-secondary",t.addEventListener("click",xn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-forward",t.style.marginRight="80px",t.innerHTML="&#9654&nbsp&nbsp&#9614",t.className="btn btn-secondary",t.addEventListener("click",bn.bind(this,!0)),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="delete-button",t.innerHTML=q.delbutton,t.className="btn btn-secondary",t.addEventListener("click",pn),t.style.opacity=0,e.appendChild(t);t=document.createElement("label");t.id="prediction-label",t.style.opacity=0,t.style.marginLeft="6px",t.appendChild(document.createTextNode(q.predictionbox)),e.appendChild(t);t=document.createElement("input");t.type="checkbox",t.id="prediction-box",t.addEventListener("click",yn),t.style.opacity=0,t.style.marginLeft="2px",e.appendChild(t)}(),Gn(),function(e){var t,n=document.getElementById("student-menu");for(t in(se=document.createElement("select")).size=3,se.id="replay-select",se.style="height: "+(J-12)+"px;",se.addEventListener("change",function(t){var n=function(e){var t,n,r=document.getElementById("replay-select");for(n=0;n<r.options.length;n++)if(r.options[n].selected){t=r.options[n].value.split("_");break}var o=t[0],l=t[1],i=t[2];et=o.split("-")[0],Ze.clusterId=i,_=z[o][l].last,E=z[o][l].nodes,I=z[o][l].links,L=z[o][l].scale,b=z[o][l].mods,ae=z[o][l][i];var s,a=z[o][l].islsa;for(s in v=z[o][l].logs,h=z[o][l].users,j=z[o][l][i].comments,R={},F={},h.forEach(function(e){F[e.id]=e.realId,R[e.realId]=e.id}),ye=1,ue=de=we=0,ae)isNaN(s)||(0<=s?de++:ue--);ut=[],dt={},Ve=!1;var c,d,u=e[o][l][i];if(u)for(Ve=!0,n=-1;ue<=n;n--)for(c in u[n]&&!u[n-1]&&(u[n-1]=u[n]),dt[n]={},u[n])for(d in u[n][c].members){var m=u[n][c].members[d].id;dt[n][R[m]]=c}Se=[],Ae={};var y,p={},g=0;for(c in ae[1]){if(n=Se.length,Se[n]={x:0,y:0},g<Ee.length)Se[n].colour=Ee[g++];else{for(;!y;)y=be[Math.floor(G.random()*be.length)],y=Ee.includes(y)?void 0:y;Se[n].colour=y}for(d in ae[1][c].members){var f=R[ae[1][c].members[d].id];Ae[f]={x:ae[1][c].members[d].x,y:ae[1][c].members[d].y},p[f]=!0}}return{members:p,did:o,gid:l,cid:i,islsa:a}}(t),e=n.members;if(P){for(var r in P.remove(),vn(),fn(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;",document.getElementById("prediction-box").checked=!1,document.getElementById("prediction-label").style.opacity=0,document.getElementById("prediction-box").style.opacity=0,st)document.body.removeChild(st[r].textbox),document.body.removeChild(st[r].button);st={}}re&&document.body.removeChild(re);if(Ne=null,mt(),n.islsa){for(var o,l=[],i=Object.keys(E),s=0;s<i.length;s++)l[s]=E[i[s]],l[s].colour=ke[l[s].entype];for(o in ne.nodes=l,I)I[o].colour=ke.originalLinks;ne.links=I,ne.edges={},pt()}else yt();oe=[0,ne.maxSession],document.getElementById("replay-stop").style.opacity=1,document.getElementById("replay-pause").style.opacity=1,document.getElementById("replay-back").style.opacity=1,document.getElementById("replay-forward").style.opacity=1,document.getElementById("delete-button").style.opacity=1,ae[-1]&&(document.getElementById("prediction-label").style.opacity=1,document.getElementById("prediction-box").style.opacity=1);ot&&ot.coordsid===n.gid&&ot.clusterid===n.cid&&(document.getElementById("prediction-box").checked=!0);for(var a=0;a<ne.nodes.length;a++)void 0===ne.nodes[a].xcoord&&(ne.nodes[a].visible=0);(function(e){(re=document.createElement("select")).multiple=!0,re.id="student-select",re.style.display="none",xe=0,h.forEach(function(e){Wt(e,re)});for(var t,n=0;n<re.options.length;n++)t=re.options[n].value,e[t]?re.options[n].selected=!0:re.options[n].selected=!1,Ae[t]&&(Ae[t].colour=re.options[n].colour);document.body.appendChild(re)})(e),ft(0),Yt(!1),K.on("mouseover",null).on("mouseout",null),_e=!0,document.getElementById("clustering-replay-comment").innerHTML="&nbsp",Ln(),setTimeout(function(){for(var e in mn(Ae,!1),Pn(),Z.on("tick",It),Ae)U.select("#centroid-"+e).call(U.drag().on("start",rn.bind(this,e)).on("drag",on.bind(this,e)).on("end",ln.bind(this,e,t,n)))},500)}.bind(this,e)),z){var r,o=0;for(r in z[t]){var l,i,s=0;for(l in o++,z[t][r])!isNaN(l)&&z[t][r][l][1]&&((i=document.createElement("option")).value=t+"_"+r+"_"+l,i.text=t.split("-")[0]+"_"+o+"_"+ ++s,se.appendChild(i))}}n.appendChild(se)}(e)):(x?gt:function(){{var e;x=Ie=!0,ee=0,Pe=Ge=Xe=null,Qe&&0!=Object.keys(E).length?(e=zt(),Xt(),Ut(e),ft(0),Gt()):(ft(.6),setTimeout(function(){var e=zt();Xt(),Ut(e),Gt()},500))}V=null})()}(u)}});
//# sourceMappingURL=behaviour-analytics.min.js.map